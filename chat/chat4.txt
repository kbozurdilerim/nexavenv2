Direkt devam ediyorum.
Bu adÄ±m **platformu â€œkopyalanamaz â€“ sÃ¼reli â€“ makineye baÄŸlÄ±â€** hale getirir.
Yine **tek seferde**, **yalnÄ±zca dosya adÄ± + kod** veriyorum.

---

# ğŸ›¡ï¸ ADIM 3

## **HWID / IP BIND + SÃœRELÄ° LÄ°SANS + RATE LIMIT**

---

## =========================

## ğŸ”§ BACKEND â€“ VERÄ°TABANI GENÄ°ÅLETME

## =========================

### ğŸ“ `backend/src/db/sqlite.js` **(GÃœNCEL â€“ TAM DOSYA)**

```js
const sqlite3 = require("sqlite3").verbose();
const db = new sqlite3.Database("./data/nexaven.db");

db.serialize(() => {
  db.run(`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      username TEXT,
      password TEXT,
      role TEXT
    )
  `);

  db.run(`
    CREATE TABLE IF NOT EXISTS licenses (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      license_key TEXT,
      owner TEXT,
      status TEXT,
      hwid TEXT,
      ip TEXT,
      expires_at TEXT
    )
  `);
});

module.exports = db;
```

---

## =========================

## ğŸ” BACKEND â€“ RATE LIMIT

## =========================

### ğŸ“ `backend/src/middleware/rateLimit.js`

```js
const requests = {};

module.exports = (limit = 10, windowMs = 60000) => {
  return (req, res, next) => {
    const ip = req.ip;
    const now = Date.now();

    if (!requests[ip]) {
      requests[ip] = [];
    }

    requests[ip] = requests[ip].filter(
      timestamp => now - timestamp < windowMs
    );

    if (requests[ip].length >= limit) {
      return res.status(429).json({
        error: "Ã‡ok fazla istek"
      });
    }

    requests[ip].push(now);
    next();
  };
};
```

---

## =========================

## ğŸ”‘ BACKEND â€“ GELÄ°ÅMÄ°Å LÄ°SANS CHECK

## =========================

### ğŸ“ `backend/src/routes/licenseCheck.js` **(GÃœNCEL)**

```js
const express = require("express");
const db = require("../db/sqlite");
const rateLimit = require("../middleware/rateLimit");

const router = express.Router();

/**
 * POST /api/license/check
 * body: { license_key, hwid }
 */
router.post("/check", rateLimit(5, 60000), (req, res) => {
  const { license_key, hwid } = req.body;
  const ip = req.ip;
  const now = new Date();

  db.get(
    "SELECT * FROM licenses WHERE license_key = ?",
    [license_key],
    (err, lic) => {
      if (!lic)
        return res.json({ valid: false, reason: "Lisans yok" });

      if (lic.status !== "active")
        return res.json({ valid: false, reason: "Pasif lisans" });

      if (lic.expires_at && new Date(lic.expires_at) < now)
        return res.json({ valid: false, reason: "Lisans sÃ¼resi dolmuÅŸ" });

      // Ä°lk baÄŸlanma
      if (!lic.hwid) {
        db.run(
          "UPDATE licenses SET hwid = ?, ip = ? WHERE id = ?",
          [hwid, ip, lic.id]
        );
      } else if (lic.hwid !== hwid) {
        return res.json({ valid: false, reason: "HWID uyuÅŸmazlÄ±ÄŸÄ±" });
      }

      res.json({
        valid: true,
        owner: lic.owner,
        expires_at: lic.expires_at
      });
    }
  );
});

module.exports = router;
```

---

## =========================

## ğŸ”§ BACKEND â€“ ADMIN LÄ°SANS OLUÅTURMA

## =========================

### ğŸ“ `backend/src/routes/license.js` **(GÃœNCEL)**

```js
const express = require("express");
const db = require("../db/sqlite");
const auth = require("../middleware/authMiddleware");

const router = express.Router();

router.get("/", auth, (req, res) => {
  db.all("SELECT * FROM licenses", [], (err, rows) => {
    res.json(rows);
  });
});

router.post("/", auth, (req, res) => {
  const { license_key, owner, days } = req.body;
  const expires = days
    ? new Date(Date.now() + days * 86400000).toISOString()
    : null;

  db.run(
    `INSERT INTO licenses
     (license_key, owner, status, expires_at)
     VALUES (?, ?, 'active', ?)`,
    [license_key, owner, expires],
    () => res.json({ status: "ok" })
  );
});

module.exports = router;
```

---

## =========================

## ğŸ¨ FRONTEND â€“ ADMIN PANEL GELÄ°ÅTÄ°RME

## =========================

### ğŸ“ `frontend/src/pages/Admin.jsx` **(GÃœNCEL)**

```jsx
import { useEffect, useState } from "react";

export default function Admin() {
  const [licenses, setLicenses] = useState([]);
  const [key, setKey] = useState("");
  const [owner, setOwner] = useState("");
  const [days, setDays] = useState("");

  const token = localStorage.getItem("token");

  useEffect(() => {
    fetch("/api/license", {
      headers: { Authorization: token }
    })
      .then(r => r.json())
      .then(setLicenses);
  }, []);

  const add = () => {
    fetch("/api/license", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: token
      },
      body: JSON.stringify({
        license_key: key,
        owner,
        days: days ? Number(days) : null
      })
    }).then(() => location.reload());
  };

  return (
    <div style={{ padding: 40 }}>
      <h2>Admin Panel</h2>

      <input placeholder="Lisans" onChange={e => setKey(e.target.value)} />
      <input placeholder="Sahip" onChange={e => setOwner(e.target.value)} />
      <input
        placeholder="GÃ¼n (boÅŸ = sÃ¼resiz)"
        onChange={e => setDays(e.target.value)}
      />
      <button onClick={add}>OluÅŸtur</button>

      <ul>
        {licenses.map(l => (
          <li key={l.id}>
            {l.license_key} | {l.owner} |{" "}
            {l.expires_at || "SÃ¼resiz"} |{" "}
            {l.hwid ? "BaÄŸlÄ±" : "BoÅŸ"}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

## =========================

## ğŸ® CLIENT / WPF / C# UYUMLU Ã–RNEK

## =========================

### ğŸ“„ Lisans DoÄŸrulama GÃ¶nderimi

```json
POST /api/license/check

{
  "license_key": "NXV-AC-2026-001",
  "hwid": "CPU-SSD-MAC-HASH"
}
```

### ğŸ“„ BaÅŸarÄ±lÄ± YanÄ±t

```json
{
  "valid": true,
  "owner": "Flamingo Game Arena",
  "expires_at": "2026-12-31T23:59:59.000Z"
}
```

---

## ğŸ”® BÄ°R SONRAKÄ° SEVÄ°YE (ADIM 4)

HazÄ±r olan zemin artÄ±k **kurumsal lisans altyapÄ±sÄ±dÄ±r**.
Bundan sonra yapÄ±lacaklar:

1. ğŸ§  **HWID hash + obfuscation**
2. ğŸ”„ **Online / offline grace period**
3. ğŸ“Š **Grafikli admin dashboard**
4. ğŸ§© **Assetto Corsa auto server.json push**
5. ğŸ§¬ **Client-side anti-debug / anti-copy**
6. ğŸ” **HTTPS + domain + reverse proxy**

Bu noktada Nexaven:

> **satÄ±labilir, daÄŸÄ±tÄ±labilir, lisanslanabilir bir Ã¼rÃ¼n** olur.

Bir sonraki adÄ±mÄ± da aynen bÃ¶yle **tam kod** ister misin,
yoksa belirli bir maddeyi mi derinleÅŸtireyim?
